@model Silicus.EncourageWithAzureAd.Web.Models.ShortlistedNominationViewModel
@using System.Drawing;
@{
    ViewBag.Title = "ReviewedNominations";
}


<div class="row white-bg header-row">
    <nav class="" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
        </div>
    </nav>
    <div class="col-lg-11 col-md-11 col-sm-11">
        <h1 class="header-name">Shortlisted Nominations</h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="box M-T15 M-B60">
            <div class="sttabs tabs-style-linebox">
                <nav>
                    <ul>
                        <li class="active"><a id="all-tab" data-toggle="tab" href="#all" data-awardId="0"><span>All</span></a></li>
                        @foreach (var award in Model.Awards)
                        {
                            <li><a id="@award.Code.ToLower()-tab" data-toggle="tab" href="@("#"+ award.Code.ToLower())" data-awardId="@award.Id"><span>@award.Code</span></a></li>
                        }
                    </ul>
                </nav>
                <div class="tab-content content-wrap text-center">
                    <section id="all" class="tab-pane fade in active">
                        @if (Model.ReviewFeedbackList.Count() == 0)
                        {
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="box">
                                        <div class="alert alert-danger">
                                            <span class="text-danger" style="font-size:20px">No reviewes are submitted as of now.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            @Html.Partial("~/Views/Review/Shared/_reviewFeedbackList.cshtml", Model.ReviewFeedbackList)
                        }
                    </section>
                @foreach (var award in Model.Awards)
                {
                    <section id="@award.Code.ToLower()" class="tab-pane fade">
                        <p>Content yet to come..</p>
                    </section>
                }
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="pull-right btn-nav">

                                @{  bool _disabled = false;
                                    foreach (var item in Model.ReviewFeedbackList)
                                    {
                                        if (item.IsWinner == true)
                                        {
                                            _disabled = true;
                                            break;
                                        }
                                    }
                                    if (_disabled == false)
                                    {

                                        <div class="pull-right btn-nav">
                                            <input type="button" value="Reject All" class="btn btn-primary" id="rejectAll" onclick="return rejectAllNominations()" style="margin-left:3%;" />
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="pull-right btn-nav">
                                            <input type="button" value="Reject All" disabled class="btn btn-primary" id="rejectAll" onclick="return rejectAllNominations()" style="margin-left:3%;" />
                                        </div>
                                    }
                                }

                            </div>
                        </div>
                    </div>
                </div><!-- /content -->
            </div>
        </div>
    </div>

</div>

<script src="~/js/jquery-2.1.1.js"></script>
<script>
    $(function () {

        $('.fa-trophy').tooltip();
        $('.fa-star').tooltip();
    });

    function rejectAllNominations() {
        swal({
            title: "Reject all nominations",
            text: "Do you want to reject all nominations?",
            type: "info",
            showCancelButton: true,
            confirmButtonColor: "#0070b9",
            confirmButtonText: "Yes!",
            cancelButtonText: "No!",
            closeOnConfirm: false,
            closeOnCancel: false
        },
       function (isConfirm) {
           if (isConfirm) {
               $(".loader-overlay").show();
               $.ajax({
                   type: 'post',
                   url: '@Url.Action("RejectAll", "Review")',
                   success: function (data) {
                       $(".loader-overlay").hide();
                       swal({
                           title: "All nominations rejected..",
                           showCancelButton: false,
                           confirmButtonColor: "#88a364",
                           confirmButtonText: "Ok"
                       },
                       function () {
                           if (isConfirm) {
                               window.location.href = '@Url.Action("ReviewFeedbackList", "Review")';
                           }
                       });
                   },
                   error: function () {
                       $(".loader-overlay").hide();
                       swal("Error", "Oops! Something wrong happened..");
                   }
               });
           } else {
               swal("Cancelled", "Rejection of all nominations Cancelled");
               window.location.href = '@Url.Action("ReviewFeedbackList", "Review")';
           }
       });

    }

    var _urlReviewFeedbackListForActiveMonth = '@Url.Action("GetReviewFeedbackListPartialView", "Review", new { forCurrentMonth = true })';
    var _urlReviewFeedbackListForHistoricalMonths = '@Url.Action("GetReviewFeedbackListPartialView", "Review", new { forCurrentMonth = false })';

    $("#pinnacle-tab").on("click", function () {
        var awardId = +$(this).attr("data-awardId");
        $(".loader-overlay").show();
        $.ajax({
            type: "GET",
            url: _urlReviewFeedbackListForActiveMonth,
            data:{awardType: awardId},
            success: function (response) {
                $(".loader-overlay").hide();
                $("#pinnacle").html(response);
            },
            error: function (error) {
                $(".loader-overlay").hide();
                console.log(error);
            }
        });
    });

    $("#som-tab").on("click", function () {
        var awardId = +$(this).attr("data-awardId");
        $(".loader-overlay").show();
        $.ajax({
            type: "GET",
            url: _urlReviewFeedbackListForActiveMonth,
            data: { awardType: awardId },
            success: function (response) {
                $(".loader-overlay").hide();
                $("#som").html(response);
            },
            error: function (error) {
                $(".loader-overlay").hide();
                console.log(error);
            }
        });
    });

    $("#all-tab").on("click", function () {
        var awardId = +$(this).attr("data-awardId");
        $(".loader-overlay").show();
        $.ajax({
            type: "GET",
            url: _urlReviewFeedbackListForActiveMonth,
            data: { awardType: awardId },
            success: function (response) {
                $(".loader-overlay").hide();
                $("#all").html(response);
            },
            error: function (error) {
                $(".loader-overlay").hide();
                console.log(error);
            }
        });
    });

</script>
