@using Kendo.Mvc.UI;
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="height:500px;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Activate Test Suite</h4>
            </div>
            <input type="hidden" id="testSuiteId" name="testSuiteId" value="@TempData[" tessuiteid"].ToString()" />
            <div class="modal-body">
                @(Html.Kendo().Grid<Silicus.Ensure.Models.DataObjects.User>().Name("userGrids")
                .Columns(columns =>
              {
                  columns.Bound("").ClientTemplate("<input type='checkbox' name='selectUser' value='#= UserId#' />").Width(20);
                  columns.Bound(p => p.FirstName).Width(50);
                  columns.Bound(p => p.LastName).Width(50);
                  columns.Bound(p => p.Address).Width(100);
                  columns.Bound(p => p.Email).Width(50);
              })
            .DataSource(dataSource => dataSource
                  .Ajax()
                  .Model(model =>
                  {
                      model.Id(p => p.UserId);
                      model.Field(p => p.UserId).Editable(false);
                  })
                                   .Read(read => read.Action("TestSuitUsers", "Admin"))
                  .PageSize(10)
              )
              .Pageable()
              .Sortable()
              @*.ToolBar(toolbar =>
               {
                   toolbar.Template(@<text>
                    <div class="toolbar">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></span>
                                    <input type="text" class="form-control" id='FieldFilter' placeholder="Search for...">
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button" style="height:16px;"><span class="glyphicon glyphicon-refresh" aria-hidden="true"></span></button>
                                    </span>
                                </div>
                            </div>
                        </div>                      
                    </div>
                </text>);
               })*@
)
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button id="btnAssign" type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script>    
    $(document).ready(function () {
        $('#testSuiteId').val('@TempData["TesSuiteId"]');
        $('#btnAssign').click(function () {
            if (confirm("Are you sure you want to assign this test suite?")) {
                var users = $("#userGrids").find("[name='selectUser']:checked").map(function () {
                    return this.value;
                }).get().join(",");
                var testSuiteId = $('#testSuiteId').val();
                alert(users);
                alert(testSuiteId);
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("TestSuiteActivate", "Admin")',
                    data: { users: users,testSuiteId:testSuiteId },
                    success: function (returndata) {
                        if (returndata == 1) {
                            $('#userGrids').data('kendoGrid').dataSource.read();
                            $('#userGrids').data('kendoGrid').refresh();
                            ShowMessage("Activated test suite.", 1);
                        }
                        else {
                            ShowMessage("Error occured while activating test suite.", 0);
                        }
                    }
                });
            }
        });

        //$("#FieldFilter").keyup(function () {

        //    var value = $("#FieldFilter").val();
        //    grid = $("#userGrids").data("kendoGrid");

        //    if (value.length > 1) {
        //        if (value) {
        //            grid.dataSource.filter({ field: "FirstName", operator: "contains", value: value });
        //        } else {
        //            grid.dataSource.filter({});
        //        }
        //    }
        //    else if (value == "")
        //        grid.dataSource.filter({});
        //});
    });
</script>