@model Silicus.Ensure.Web.Models.QuestionModel
@using Kendo.Mvc.UI;
@using Silicus.Ensure.Models.Constants;

@{
    ViewBag.Title = "Add Questions";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="main-content">
    @using (Html.BeginForm("AddQuestions", "QuestionBank"))
    {
        <div class="fluid mt20">
            <div class="row">
                <div class="alert alert-danger" id="errorDiv">
                    <strong>Error!</strong> <span id="errorContent">This alert box could indicate a dangerous or potentially negative action.</span>
                </div>
                <div class="col-md-4">
                    <span>Question Type:</span><span style="color:red">*</span>
                </div>
                <div class="col-md-8">
                    @(Html.Kendo().DropDownListFor(m => m.QuestionType)
                .Name("QuestionType")
                .Value(Model.QuestionType)
                .Events(e => e.Change("QuestionTypeChange"))
                .BindTo(EnumHelper.GetSelectList(typeof(QuestionType)))
                .HtmlAttributes(new { style = "width: 100%" }))
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-4">
                    <span>Question Description:</span><span style="color:red">*</span>
                </div>
                <div class="col-md-8">
                    @Html.Kendo().EditorFor(m => m.QuestionDescription).Name("QuestionDescription").Encode(true).Value(Model.QuestionDescription)
                </div>
            </div>
            <br />

            <div id="practical">

                <div class="row">
                    <div class="col-md-4">
                        <span>Answer Type:</span><span style="color:red">*</span>
                    </div>
                    <div class="col-md-8">
                        @(Html.Kendo().DropDownListFor(m => m.AnswerType)
                    .Name("AnswerType")
                    .Value(Model.AnswerType.ToString())
                    .BindTo(EnumHelper.GetSelectList(typeof(AnswerType)))
                    .HtmlAttributes(new { style = "width: 100%" }))
                    </div>
                </div>
                <br />

                <div class="row">
                    <div class="col-md-4">
                        <span>Multiple Answer Questions</span>
                    </div>
                </div>
                <br />

                <div class="row">
                    <div class="col-md-4">
                        <span>Option 1:</span><span style="color:red">*</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option1, new { @class = "form-control", Value = @Model.Option1 })
                    </div>
                </div>

                <div class="row" id="rowOpt2">
                    <div class="col-md-4">
                        <span>Option 2:</span><span style="color:red">*</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option2, new { @class = "form-control", Value = @Model.Option2 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt2").Icon("plus").HtmlAttributes(new { type = "button", param = "2" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                    </div>
                </div>

                <div class="row" id="rowOpt3">
                    <div class="col-md-4">
                        <span>Option 3:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option3, new { @class = "form-control", Value = @Model.Option3 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt3").Icon("plus").HtmlAttributes(new { type = "button", param = "3" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                        @(Html.Kendo().Button().Name("btnDelOpt3").Icon("close").HtmlAttributes(new { type = "button", param = "3" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row" id="rowOpt4">
                    <div class="col-md-4">
                        <span>Option 4:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option4, new { @class = "form-control", Value = @Model.Option4 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt4").Icon("plus").HtmlAttributes(new { type = "button", param = "4" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                        @(Html.Kendo().Button().Name("btnDelOpt4").Icon("close").HtmlAttributes(new { type = "button", param = "4" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row" id="rowOpt5">
                    <div class="col-md-4">
                        <span>Option 5:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option5, new { @class = "form-control", Value = @Model.Option5 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt5").Icon("plus").HtmlAttributes(new { type = "button", param = "5" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                        @(Html.Kendo().Button().Name("btnDelOpt5").Icon("close").HtmlAttributes(new { type = "button", param = "5" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row" id="rowOpt6">
                    <div class="col-md-4">
                        <span>Option 6:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option6, new { @class = "form-control", Value = @Model.Option6 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt6").Icon("plus").HtmlAttributes(new { type = "button", param = "6" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                        @(Html.Kendo().Button().Name("btnDelOpt6").Icon("close").HtmlAttributes(new { type = "button", param = "6" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row" id="rowOpt7">
                    <div class="col-md-4">
                        <span>Option 7:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option7, new { @class = "form-control", Value = @Model.Option7 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnAddOpt7").Icon("plus").HtmlAttributes(new { type = "button", param = "7" }).Events(e => e.Click("OptionAdd")).Content("Add"))
                        @(Html.Kendo().Button().Name("btnDelOpt7").Icon("close").HtmlAttributes(new { type = "button", param = "7" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row" id="rowOpt8">
                    <div class="col-md-4">
                        <span>Option 8:</span>
                    </div>
                    <div class="col-md-6">
                        @Html.TextBoxFor(m => m.Option8, new { @class = "form-control", Value = @Model.Option8 })
                    </div>
                    <div class="col-md-2">
                        @(Html.Kendo().Button().Name("btnDelOpt8").Icon("close").HtmlAttributes(new { type = "button", param = "8" }).Events(e => e.Click("OptionDelete")).Content("Delete"))
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4">
                        <span>Correct Answer:</span><span style="color:red">*</span>
                    </div>

                    <div class="col-md-8">
                        @(Html.Kendo().MultiSelectFor(m => m.CorrectAnswer)
                    .Name("CorrectAnswer")
                    .Placeholder("Select correct option(s)...")
                    .BindTo(EnumHelper.GetSelectList(typeof(Options)))
                    .Value(Model.CorrectAnswer).HtmlAttributes(new { style = "width: 100%" }))
                    </div>
                </div>
            </div>


            <div class="row" id="practicalAns">
                <div class="col-md-4">
                    <span>Answer:</span>
                </div>
                <div class="col-md-8">
                    @Html.Kendo().EditorFor(m => m.Answer).Name("Answer").Encode(true).Value(Model.Answer)
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-4">
                    <span>Skill Tags:</span><span style="color:red">*</span>
                </div>

                <div class="col-md-8">
                    @(Html.Kendo().MultiSelectFor(m => m.SkillTag)
                .DataTextField("TagName")
                .DataValueField("TagId")
                .Placeholder("Select skill set...")
                .BindTo(Model.SkillTagsList)
                .Value(Model.SkillTag)
                .HtmlAttributes(new { style = "width: 100%" }))
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-4">
                    <span>Proficiency Level:</span><span style="color:red">*</span>
                </div>

                <div class="col-md-8">
                    @(Html.Kendo().DropDownListFor(m => m.ProficiencyLevel)
                .Name("ProficiencyLevel")
                .Value(Model.ProficiencyLevel)
                .BindTo(EnumHelper.GetSelectList(typeof(Proficiency)))
                .HtmlAttributes(new { style = "width: 100%" }))
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-4">
                    <span>Duration (Min):</span><span id="durationRequired" style="color:red">*</span>
                </div>

                <div class="col-md-8">
                    @(Html.Kendo().DropDownListFor(m => m.Duration)
                .Name("Duration")
                .Value(Model.Duration.ToString())
                .BindTo(EnumHelper.GetSelectList(typeof(DurationMarks)))
                .HtmlAttributes(new { style = "width: 100%" }))
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-4">
                    <span>Marks:</span><span style="color:red">*</span>
                </div>

                <div class="col-md-8">
                    @(Html.Kendo().DropDownListFor(m => m.Marks)
                .Name("Marks")
                .Value(Model.Marks.ToString())
                .BindTo(EnumHelper.GetSelectList(typeof(DurationMarks)))
                .HtmlAttributes(new { style = "width: 100%" }))
                </div>
            </div>
            <br />

            <div class="row">
                <div class="col-md-6"></div>
                <div class="col-md-2 col-md-offset-4">
                    @(Html.Kendo().Button()
                .Name("btnCancel").Icon("cancel")
                .HtmlAttributes(new { type = "button" })
                .Events(e => e.Click("OnCancel"))
                .Content("Cancel"))

                    @(Html.Kendo().Button()
                .Name("btnSave").Icon("tick")
                .HtmlAttributes(new { type = "submit" })
                .Content("Save"))
                </div>
            </div>
            @Html.HiddenFor(m => m.OptionCount, new { Value = @Model.OptionCount })
            @Html.HiddenFor(m => m.CreatedOn, new { Value = @Model.CreatedOn })
            @Html.HiddenFor(m => m.CreatedBy, new { Value = @Model.CreatedBy })
            @Html.HiddenFor(m => m.Id, new { Value = @Model.Id })
            @Html.HiddenFor(m => m.Edit, new { Value = @Model.Edit })

            <script>
                $(document).ready(function () {

                    // Hide More Than 2 Options.
                    for(var i=3; i<=8; i++)
                    {
                        $("#rowOpt"+i).hide();
                    }

                    $("#errorDiv").hide();
                    $("#durationRequired").hide();
                    $("#practicalAns").hide();


                    var success =@Model.Success;
                    var edit="@Model.Edit";
                    if(success==1)
                    {
                        if(edit=="True"){
                            $("#myModal").modal();
                            $("#msgContent").text("Question updated successfully.");
                        }
                        else{
                            $("#myModal").modal();
                            $("#msgContent").text("Question added successfully in the application.");
                        }
                    }
                    else
                    {
                        if(edit=="True"){
                            var optCnt=@Model.OptionCount;
                            OptionDispalyOnEdit(optCnt);
                        }
                    }



                    // Check Question Type on Edit.
                    var Qtype=@Model.QuestionType;
                    if(Qtype=="2")
                    {
                        $("#practical").hide();
                        $("#practicalAns").show();
                        $("#durationRequired").show();
                    }

                    // Save and Edit Activity Validation.
                    $("#btnSave").click(function () {

                        var qType = $('#QuestionType').val();

                        if ($("#QuestionDescription").val().trim().length == 0) {
                            $("#QuestionDescription").focus();
                            ShowError("Question description cann't be blank.");
                            return false;
                        }
                        else {

                            if (qType == 1) {
                                if ($("#Option1").val().trim().length == 0) {
                                    $("#Option1").focus();
                                    ShowError("Option 1 cann't be blank.");
                                    return false;
                                }
                                else if ($("#Option2").val().trim().length == 0) {
                                    $("#Option2").focus();
                                    ShowError("Option 2 cann't be blank.");
                                    return false;
                                }
                                else if ($("#CorrectAnswer :selected").length == 0) {
                                    $("#CorrectAnswer").focus();
                                    ShowError("Select at least 1 correct answer.");
                                    return false;
                                }
                            }

                            if ($("#SkillTag :selected").length == 0) {
                                $("#SkillTag").focus();
                                ShowError("Select at least 1 skill tag.");
                                return false;
                            }
                        }
                    });

                });

                // Show Error Animation
                function ShowError(content) {
                    $("#errorDiv").show();
                    $("#errorContent").text(content);
                    $("html, body").animate({ scrollTop: 0 }, "slow");
                    $("#errorDiv").fadeOut(10000);
                }

                // Question Type Change
                function QuestionTypeChange() {
                    var value = $("#QuestionType").val();
                    if (value == "2") {
                        $("#practical").hide();
                        $("#practicalAns").show();
                        $("#durationRequired").show();
                    }
                    else {
                        $("#practical").show();
                        $("#practicalAns").hide();
                        $("#durationRequired").hide();

                    }

                    $("#Option1").val("");
                    $("#Option2").val("");
                    $("#Option3").val("");
                    $("#Option4").val("");
                    var Answer = $("#Answer").data("kendoEditor");
                    Answer.value("");
                    var CorrectAnswer = $('#CorrectAnswer').data("kendoMultiSelect");
                    CorrectAnswer.value([]);
                    var SkillTag = $('#SkillTag').data("kendoMultiSelect");
                    SkillTag.value([]);
                    var AnswerType = $("#AnswerType").data("kendoDropDownList");
                    AnswerType.value("1");
                    var Competency = $("#Competency").data("kendoDropDownList");
                    Competency.value("1");
                    var Duration = $("#Duration").data("kendoDropDownList");
                    Duration.value("1");
                }

                function OnCancel() {
                    window.location.href = "/QuestionBank/QuestionBank";
                }

                function OptionAdd(e){
                    var param = this.element.attr("param");
                    OptionDispaly('A',param);
                }

                function OptionDelete(e){
                    var param = this.element.attr("param");
                    OptionDispaly('D',param);
                }

                function OptionDispaly(task, opt)
                {
                    var op=parseInt(opt);
                    if(task=='A'){
                        $("#OptionCount").val(op+1);
                        if(op==2||op==7)
                        {
                            $("#btnAddOpt"+op).hide();
                        }
                        for(var i=op; i<=op+1; i++)
                        {
                            $("#rowOpt"+i).show();
                            $("#btnDelOpt"+i).show();
                        }
                        if(op!=7)
                        {
                            for(var i=op+2; i<=8; i++)
                            {
                                $("#rowOpt"+i).hide();
                                $("#btnAddOpt"+op).hide();
                            }
                        }
                    }
                    else{
                        var opCnt = parseInt($("#OptionCount").val());
                        $("#Option"+opCnt).val("");
                        $("#rowOpt"+opCnt).hide();
                        $("#btnAddOpt"+(opCnt-1)).show();
                        $("#OptionCount").val(opCnt-1)
                    }
                }

                function OptionDispalyOnEdit(opt)
                {
                    var op=parseInt(opt);
                    if(op>2)
                    {
                        $("#btnAddOpt2").hide();
                        for(var i=3; i<=op; i++)
                        {
                            $("#rowOpt"+i).show();
                            $("#btnDelOpt"+i).show();

                            if(i!=op)
                                $("#btnAddOpt"+i).hide();
                        }
                    }
                }
            </script>
            <style>
                .height {
                    height: 250px;
                }

                .required {
                    color: red;
                }
            </style>
        </div>
    }
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" role="dialog" onclick="OnCancel();">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" onclick="OnCancel();">&times;</button>
                <h4 class="modal-title"><span id="msgMain">Success!</span></h4>
            </div>
            <div class="modal-body">
                <p id="msgContent">Some text in the modal.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="OnCancel();">Close</button>
            </div>
        </div>

    </div>
</div>
