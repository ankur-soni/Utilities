@model Silicus.Ensure.Web.Models.Employee.EmployeeTestSuitViewModel
@using Silicus.Ensure.Models.Constants;
@using Kendo.Mvc.UI;
@using System.Linq
@{
    ViewBag.Title = "AssigedTest";
}

<div class="row">
    <div class="col-sm-12">
        <h1 class="page-title">
            Assigned Test
        </h1>
    </div>
</div>
<script>
    $(document).ready(function () {
        var title = $('.page-title').text();
        $('#CurrentPageTitle').text(title);

        SelectedMenu('#emp-assigned-test');
        SetNavigationMenuActive('AssignedTest');
    });

    function StartTest(EmployeeTestSuiteId, EmployeeId) {
        var newwindow = window.open("/Test/OnlineTest?EmployeeTestSuitId=" + EmployeeTestSuiteId + "&CandidateId=''&employeeId=" + EmployeeId, "_blank", "toolbar=yes,scrollbars=yes,resizable=no,top=0,left=0,width=" + $(window).width() + ",height=" + $(window).height());
        $(newwindow).unload(function () {
                $("#EmployeeTestSuitGrid").data("kendoGrid").dataSource.read();
        });
    }
</script>

<div class="table-responsive M-B15">


            @(Html.Kendo().Grid<Silicus.Ensure.Web.Models.Employee.EmployeeTestSuitViewModel>().Name("EmployeeTestSuitGrid")

         .Columns(columns =>
         {
             columns.Bound(p => p.TestSuitName).Title("Test Suit Name").Width(200);
             // columns.Bound(p => p.Duration).Title("Requisition id").Width(100);
             columns.Bound(p => p.Duration).ClientTemplate(@"#=Duration# Mins");
             //columns.Bound(p => p.PracticalCount).ClientTemplate(@"#=ObjectiveCount #+#PracticalCount #").Title("Total Questions").Width(130);
             columns.Bound(p => p.MarksObtained).ClientTemplate(@"#=MarksObtained > 0? MarksObtained : 'NA'#");
             columns.Bound(p => p.AttemptDate).Format("{0:dd-MMM-yyyy hh:mm:ss tt}").Filterable(false);
             columns.Bound(p => p.StatusId).ClientTemplate(@"
                                                                        #if(StatusId==2){#
                                                                            Test assigned
                                                                        #}
                                                                        else if(StatusId==3) {#
                                                                            Test submitted
                                                                        #}
                                                                        else if(StatusId==4) {#
                                                                            Under evaluation
                                                                        #}
                                                                        else if(StatusId==7) {#
                                                                           On hold
                                                                        #}
                                                                        else{#
                                                                            #=StatusId#
                                                                        #}
                                                                        #").Title("Status").Width(250);
             columns.Bound(p => p.StatusId).ClientTemplate(@"
                                                                        #if(StatusId==2){#
                                                                            <a onclick='StartTest(#=EmployeeTestSuiteId#,#=EmployeeId#)'>Start Test</a>
                                                                        #}
                                                                        else if(StatusId==3) {#
                                                                            Test Submitted
                                                                        #}
                                                                        else{#
                                                                            --------------
                                                                        #}
                                                                        #").Title("Test Action");})
                                       .DataSource(dataSource => dataSource
                                       .Ajax()
                                       .Model(model =>
                                       {
                                           model.Id(p => p.EmployeeTestSuiteId);
                                           model.Field(p => p.EmployeeId).Editable(false);
                                       }).Group(g => g.Add(c => c.StatusId))

                                       .Read(read => read.Action("GetEmployeeTestSuits", "Employee"))

                                       .PageSize(100)
                                       .ServerOperation(true)
                                       )
                                       .HtmlAttributes(new { style = "height: 70vh;" })
                                       .Pageable(p => p.PageSizes(false))
                                        .Scrollable(scrollable => scrollable.Virtual(true))
                                       .Sortable()
                                       .Resizable(resizing => resizing.Columns(true))
            )




        </div>



