@model IEnumerable<Silicus.Encourage.Models.Criteria>

<script src="~/js/jquery.barrating.min.js"></script>

<div class="wizard-box" style="margin-top:10px;" id="criterias">
    <div class="row">
        <div class="col-md-12">
            <div class="table-responsive">
                <table class="table table-hover" id="criteriaTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Criteria</th>
                            <th>Weightage</th>
                            <th>Rating</th>
                            <th>Manager Comments</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int i = 0;}
                        @foreach (var criteria in Model)
                        {
                            <tr>
                                <td>
                                    @(i+1)
                                </td>
                                <td class="col-lg-5 col-md-4 col-sm-4 col-xs-4">
                                    <label> @criteria.Title</label>
                                </td>
                                <td class="col-lg-1 col-md-1 col-sm-1 col-xs-1">
                                    @Html.DropDownList("Comments[" + @i + "].Weightage",
                                    Enumerable.Range(0, 21).Select(x => x * 5).
                                    Select(j => new SelectListItem
                                    {
                                        Value = j.ToString(),
                                        Text = j.ToString()
                                    }), new { @class = "form-control ddlWeightage" })
                                </td>
                                <td class="col-lg-3 col-md-4 col-sm-6 col-xs-4">
                                    <select id="rating-@i" class="example-square" name="Comments[@i].Rating" autocomplete="off" value="" row-id="@i">
                                        <option value=""></option>
                                        <option value="1">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                    </select>
                                </td>
                                <td class="col-lg-3 col-md-4 col-sm-3 col-xs-3">
                                    <textarea class="form-control" onblur="return hideRemainingCharacterText(@i)"
                                              onkeyup="edValueKeyPress(@i)"
                                              rows=""
                                              name="Comments[@i].Comment"
                                              id="@("comment"+i)"
                                              maxlength="500"
                                              iscommentrequired="false"></textarea>
                                    <div class="@("textarea"+i)"></div>

                                    <div class="col-md-5 criteriaComment">

                                    </div>
                                </td>
                                <td>
                                    <input type="hidden" name="Comments[@i].Id" value="@criteria.Id">
                                    <span class="hide">@(i++)</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        var ratings = $('.example-square');
        
        $.each(ratings, function (index) {
            var id = "#"+this.id;
            var rating = +this.getAttribute("value");
            
            $(id).barrating('show', {
                theme: 'bars-square',
                showValues: true,
                showSelectedRating: false,
                onSelect: function(value, text,event) {
                    var element = this.$elem[0];
                    var rowId = +element.getAttribute("row-id");

                    var commentId = "#comment"+rowId;
                    if (+value != 0) {
                        $(commentId).attr("isCommentRequired", true);
                        if ($(commentId).val() == "") {
                            $(commentId).addClass("noCommentError");
                        }
                    }else{
                        $(commentId).attr("isCommentRequired", false);
                        $(commentId).removeClass("noCommentError");
                    }
                }
            });

            $(id).barrating('set',rating);
        })
    });
</script>